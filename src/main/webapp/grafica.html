
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css"
	href="./KUAJII MONITORING SITE_files/standard-css-default-ltr-ltr.css">

<link rel="stylesheet" type="text/css"
	href="./KUAJII MONITORING SITE_files/overlay.css">


<link rel="stylesheet" type="text/css" href="resources/css/style.css">
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>Google Visualization API Sample</title>
<script type="text/javascript" src="//www.google.com/jsapi"></script>
<link rel="stylesheet"
	href="http://code.jquery.com/ui/1.10.0/themes/base/jquery-ui.css" />
<script src="http://code.jquery.com/jquery-1.8.3.js"></script>
<script src="http://code.jquery.com/ui/1.10.0/jquery-ui.js"></script>
<link rel="stylesheet" href="resources/css/style.css" />

<script type="text/javascript">
	google.load('visualization', '1', {
		packages : [ 'corechart' ]
	});
</script>
<script type="text/javascript">

  google.load("visualization", "1", {packages:["corechart"]});

  function drawDonut(dataDonut) {
    var data = google.visualization.arrayToDataTable(dataDonut);

    var options = {
      title: 'Donut con los status HTTP.',
      pieHole: 0.4,
    };

    var chart = new google.visualization.PieChart(document.getElementById('donutchart'));
    chart.draw(data, options);
  }
</script>

</head>
<body id="body" onload="load();">

	<div id="sites-chrome-everything-scrollbar">
		<div id="sites-chrome-everything">
			<div id="sites-chrome-page-wrapper" style="direction: ltr">
				<div id="sites-chrome-page-wrapper-inside">
					<div id="sites-chrome-main-wrapper">
						<div id="sites-chrome-main-wrapper-inside">
							<table id="sites-chrome-main" class="sites-layout-hbox">
								<tbody>
									<tr>
										<td id="sites-chrome-sidebar-left"
											class="sites-layout-sidebar-left" style="width: 200px">
											<div id="COMP_30107336677610874" class="sites-embed">
												<div class="sites-embed-content sites-sidebar-nav">
													<ul class="has-expander">

														<li class="topLevel parent ">
															<div dir="ltr" style="padding-left: 0px;">
																<div class="expander"></div>
																<a class="sites-navigation-link topLevel">Configuración</a>
															</div>
															<ul class="has-expander">
																<li class="">

																	<table style="font-size: 14PX; padding-left: 38px;">
																		<tr>
																			<td><a onclick="callService();"> test</a></td>
																			<td></td>
																		</tr>
																		<tr>
																			<td><a> Agrupado</a></td>
																			<td><input type="text" id="agrupador" onchange="callService();" value="0"	style="margin: 0 0 1px 0; vertical-align: text-top; width: 30px; height: 15px;"></input></td>
																		</tr>
																	</table>
																</li>
															
															</ul>
														</li>
													</ul>
												</div>
											</div>
										</td>
										<td id="sites-canvas-wrapper">


											<div id="sites-canvas-main-content">


												<script>
													var parameterService = null;
													var parameterTO = null;
													var parameterAggregate = null;
													var parameterStandaDesviation = null;
													var parameteragrupador = null;
													var parameterDate = null;
													var parameterFrecuenciaTiempo = null;
													var parameterapplication  = null;

													function callService() {
														console
																.log("callService");
														
														

														var agrupador = document.getElementById('agrupador').value;
														
														var url = "/ListaLlamadasAgrupadasPorTiempo?serviceName="
																+ parameterService
																+ "&ancho="
																+ agrupador
																+ '&timeOut='
																+ parameterTO
																+ "&frecuenciaTiempo="
																+ parameterFrecuenciaTiempo
																+ "&application="+parameterapplication;

														function handler() {

															if (client.readyState == 4
																	&& client.status == 200) {
																console
																		.log("Handler start");
																console
																		.log(client.responseText);
																printData(client.responseText);
																console
																		.log("Handler FIN");
															}
														}

														var client = new XMLHttpRequest();
														client.onreadystatechange = handler;
														client.open("GET", url);
														client.send();

													}
													

													function printData(dataJson) {

														var json = JSON
																.parse(dataJson);
														console.log(json);
														if(json.listDataDonut.length > 0)
															drawDonut(json.listDataDonut);
														try {

															var title = "Gráfica que recoge el Nº de llamadas por intervalo de milisegundos";

															/*  var data = google.visualization.arrayToDataTable([
															                                                   ['Month', 'Bolivia', 'Ecuador', 'Madagascar', 'Papua New Guinea', 'Rwanda', 'Average'],
															                                                   ['2004/05',  165,      938,         522,             998,           450,      614.6],
															                                                   ['2005/06',  135,      1120,        599,             1268,          288,      614.6],
															                                                   ['2006/07',  157,      1167,        587,             807,           397,      614.6],
															                                                   ['2007/08',  139,      1110,        615,             968,           215,      614.6],
															                                                   ['2008/09',  136,      691,         629,             1026,          366,      614.6]
															                                                 ]);
															 */

															console
																	.log("eje y : "
																			+ json.axisY);
															console
																	.log("eje x : "
																			+ json.axisX);

															var data = google.visualization
																	.arrayToDataTable(json.listData);

															var options = {
																title : title,
																width : 1000,
																height : 600,
																vAxis : {
																	title : json.axisY
																},
																hAxis : {
																	title : json.axisX
																},
																seriesType : "bars",
																series : {
																	1 : {
																		type : "line"
																	}
																}
															};

															
															var chart = new google.visualization.ComboChart(
																	document
																			.getElementById('visualization'));
															// The select handler. Call the chart's getSelection() method
															function selectHandler() {
																var selectedItem = chart
																		.getSelection()[0];
																console
																		.log("selectedItem"
																				+ selectedItem);
																if (selectedItem) {
																	var value = data
																			.getValue(
																					selectedItem.row,
																					selectedItem.column);
																	alert('The user selected '
																			+ value);
																	console
																			.log("row:"
																					+ selectedItem.row
																					+ " -> "
																					+ json.listData[selectedItem.row + 1][0]);
																	console
																			.log("column:"
																					+ selectedItem.column);
																}
															}

															// Listen for the 'select' event, and call my function selectHandler() when
															// the user selects something on the chart.
															google.visualization.events
																	.addListener(
																			chart,
																			'select',
																			selectHandler);

															chart.draw(data,
																	options);

															console
																	.log('Data create OK');

														} catch (err) {
															console
																	.log('ERROR: '
																			+ err);
														}

														console
																.log("printData FIN");

													}

													function drawVisualization() {
														// Some raw data (not necessarily accurate)
														var data = google.visualization
																.arrayToDataTable([
																		[
																				'Month',
																				'Bolivia',
																				'Ecuador',
																				'Madagascar',
																				'Papua New Guinea',
																				'Rwanda',
																				'Average' ],
																		[
																				'2004/05',
																				165,
																				938,
																				522,
																				998,
																				450,
																				614.6 ],
																		[
																				'2005/06',
																				135,
																				1120,
																				599,
																				1268,
																				288,
																				682 ],
																		[
																				'2006/07',
																				157,
																				1167,
																				587,
																				807,
																				397,
																				623 ],
																		[
																				'2007/08',
																				139,
																				1110,
																				615,
																				968,
																				215,
																				609.4 ],
																		[
																				'2008/09',
																				136,
																				691,
																				629,
																				1026,
																				366,
																				569.6 ] ]);

														var options = {
															title : 'Monthly Coffee Production by Country',
															vAxis : {
																title : "Cups"
															},
															hAxis : {
																title : "Month"
															},
															seriesType : "bars",
															series : {
																5 : {
																	type : "line"
																}
															}
														};

														var chart = new google.visualization.ComboChart(
																document
																		.getElementById('chart_div'));
														chart.draw(data,
																options);
													}
													google
															.setOnLoadCallback(drawVisualization);

													function load() {

														console.log("log");

														parameterService = GetUrlValue("service");
														parameterTO = GetUrlValue("to");
														
														parameterStandaDesviation = GetUrlValue("standaDesviation");
														parameteragrupador = GetUrlValue("agrupador");
														parameterapplication =  GetUrlValue("application");
														parameterDate = GetUrlValue("fecha");
														parameterFrecuenciaTiempo = GetUrlValue("frecuenciaTiempo");
														document
																.getElementById("agrupador").value = parameteragrupador;

														console
																.log("frecuenciaTiempo:"
																		+ parameterFrecuenciaTiempo);
														console
																.log("date:"
																		+ parameterDate);
														console
																.log("service:"
																		+ parameterService);
														console
														.log("application:"
																+ parameterapplication);
														console
																.log("@grupador:"
																		+ parameteragrupador);
														console.log("to:"
																+ parameterTO);
														
														console
																.log("StandaDesviation:"
																		+ parameterStandaDesviation);

														var $radios = $('input:radio[name=myRadios]');
														$radios
																.filter(
																		'[value='
																				+ parameterFrecuenciaTiempo
																				+ ']')
																.prop(
																		'checked',
																		true);

														callService();
													}

													function decode(name) {
														var find = '%20';
														var re = new RegExp(
																find, 'g');
														return name.replace(re,
																' ');
													}

													function GetUrlValue(
															VarSearch) {
														var SearchString = window.location.search
																.substring(1);
														var VariableArray = SearchString
																.split('&');
														for (var i = 0; i < VariableArray.length; i++) {
															var KeyValuePair = VariableArray[i]
																	.split('=');
															if (KeyValuePair[0] == VarSearch) {

																return decode(KeyValuePair[1]);
															}
														}
													}
												</script>
												
												
												<table>
												<tr><td> <p id="info"> </p> </td></tr>
												<tr><td id="visualization"> </td></tr>
												<tr><td id="donutchart"style="width: 500px; height: 400px;" > </td></tr>
												</table>
												
											</div>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>

				</div>

			</div>
		</div>

	</div>



</body>
</html>