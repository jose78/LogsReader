
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css"
	href="./KUAJII MONITORING SITE_files/standard-css-default-ltr-ltr.css">

<link rel="stylesheet" type="text/css"
	href="./KUAJII MONITORING SITE_files/overlay.css">


<link rel="stylesheet" type="text/css" href="resources/css/style.css">

<link rel="stylesheet"
	href="http://code.jquery.com/ui/1.10.0/themes/base/jquery-ui.css" />
<script src="http://code.jquery.com/jquery-1.8.3.js"></script>
<script src="http://code.jquery.com/ui/1.10.0/jquery-ui.js"></script>
<script src="resources/js/main_local.js"></script>


<script type="text/javascript">

	function executeService() {
		
		console.log("starting executeSErvice");

		var fecha = document.getElementById('datepicker').value;
		var frecuenciaTiempo = $('input[name=myRadios]:checked').val();
		var timeout = document.getElementById('timeout').value;
		console.log("frecuenciaTiempo: " + frecuenciaTiempo + " fecha:" + fecha
				+ " timeOut:" + timeout);

		if (frecuenciaTiempo == null) {
			frecuenciaTiempo = "historico";
		}

		console.log("Fehca:" + fecha);

		var url = "/ListServices?frecuencia=" + frecuenciaTiempo + "&fecha="
				+ fecha + "&timeout=" + timeout;

		console.log("URL: " + url);
		callService(url, function(result) {
			clean('tableServices');
			printResult(result);
			
			
			var date = new Date;
			var seconds = date.getSeconds();
			var minutes = date.getMinutes();
			var hour = date.getHours();
			document.getElementById('refreshDate').innerHTML= "Última actualziación:" + hour+":"+minutes+":"+seconds;
			
		});
	}

	$("document").ready(function() {
		$("#historico").click(function() {
			$('#datepicker').prop('disabled', true);
			$('#datepicker').value = "";
		});
	});
	$("document").ready(function() {
		$("#diario").click(function() {
			$('#datepicker').prop('disabled', false);
		});
	});

	function printResult(dataJSON) {
		var table = document.getElementById('tableServices');
		var json = JSON.parse(dataJSON);

		for (var i = 0; i < json.length; i++) {
			var data = json[i];

			var row = document.getElementById("row_" + data.service + "_"
					+ data.application);

			if (row == null) {
				row = addRow(table, data.service, data.application,
						data.aggregate);
			}
			row.insertCell(0).innerHTML = data.service;
			row.insertCell(1).innerHTML = data.application;
			row.insertCell(2).innerHTML = data.aggregate + " ms";
			/* 	row.insertCell(2).innerHTML = data.standaDesviation;
				row.insertCell(3).innerHTML = data.ok + " %"; */
			row.insertCell(3).innerHTML = data.failDown + " %";
			row.insertCell(4).innerHTML = data.failUp + " %";

			if (i % 2)
				row.className = 'alt';

			row.cells[2].align = "center";
			row.cells[3].align = "center";
			row.cells[4].align = "center";

		}
	}

	function showPanel(nameService, application) {
		console.log("showPanel:" + nameService + "   - " + application);

		var frecuenciaTiempo = $('input[name="myRadios"]:checked').val();
		var fecha = document.getElementById('datepicker').value;

		window.open("grafica.html?service=" + nameService + '&application='
				+ application + '&to=25&fecha=' + fecha + "&frecuenciaTiempo="
				+ frecuenciaTiempo, "MsgWindow" + nameService,
				"width=800, height=700");

	}
	/*
	 * .datagrid table thead th {
	 background: #1c5ba2;
	 background: -moz-linear-gradient(center top, #006699 5%, #1c5ba2 100%);
	 filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#006699', endColorstr='#1c5ba2');
	 background-color: #006699;
	 color: #FFFFFF;
	 font-size: 15px;
	 font-weight: bold;
	 border-left: 1px solid #0070A8;
	 }
	 */
	function addRow(table, nameService, application, aggregate) {

		var rows = table.rows;
		var rowCount = rows.length;

		var row = table.insertRow(rowCount);
		row.height = "30px";
		row.id = "row_" + nameService + "_" + application;
		row.onclick = function() {
			console.log("Pulsado " + nameService);
			showPanel(nameService, application);
		};

		return row;
	}
</script>
</head>
<body id="body" onload="executeService();setInterval('executeService()', 60000);">

	<div id="sites-chrome-everything-scrollbar">
		<div id="sites-chrome-everything">
			<div id="sites-chrome-page-wrapper" style="direction: ltr">
				<div id="sites-chrome-page-wrapper-inside">
					<div id="sites-chrome-main-wrapper">
						<div id="sites-chrome-main-wrapper-inside">
							<table id="sites-chrome-main" class="sites-layout-hbox">
								<tbody>
									<tr>
										<td id="sites-chrome-sidebar-left"
											class="sites-layout-sidebar-left" style="width: 200px">
											<div id="COMP_30107336677610874" class="sites-embed">
												<div class="sites-embed-content sites-sidebar-nav">
													<ul class="has-expander">

														<li class="topLevel parent ">
															<div dir="ltr" style="padding-left: 0px;">
																<div class="expander"></div>
																<a class="sites-navigation-link topLevel">Configuración</a>
															</div>
															<ul class="has-expander">
																<li class="">

																	<table style="font-size: 14PX; padding-left: 38px;">
																		<tr>
																			<td><a onclick="executeService();"> test</a></td>
																			<td></td>
																		</tr>

																		<tr>
																			<td><a> Time Out</a></td>
																			<td><input type="text" id="timeout" value="0"
																				onchange="executeService();"
																				style="margin: 0 0 1px 0; vertical-align: text-top; width: 70px; height: 15px;"></input>
																		</tr>
																		<tr>
																			<td><a>Fecha</a></td>
																			<td></td>
																		</tr>
																	</table>
																</li>


																<li class=""><div dir="ltr"
																		style="padding-left: 42px;">
																		<input type="radio" name="myRadios" id="historico"
																			checked="checked" value="historico" /> Histórico <br>
																		<input type="radio" name="myRadios" id="diario"
																			value="diario" /> Diario<input id="datepicker"
																			name="datepicker" disabled="disabled" type="date"
																			style="width: 150px;">
																		<script type="text/javascript">
																			var date = new Date();

																			var day = date
																					.getDate();
																			var month = date
																					.getMonth() + 1;
																			var year = date
																					.getFullYear();

																			if (month < 10)
																				month = "0"
																						+ month;
																			if (day < 10)
																				day = "0"
																						+ day;

																			var today = year
																					+ "-"
																					+ month
																					+ "-"
																					+ day;

																			$(
																					"#datepicker")
																					.attr(
																							"value",
																							today);
																		</script>
																	</div>
															</ul>
														</li>
													</ul>
												</div>
											</div>
										</td>
										<td id="sites-canvas-wrapper">
											<div id="sites-canvas">

												<div id="sites-canvas-main" class="sites-canvas-main">
													<div id="sites-canvas-main-content">
														<table
															class="sites-layout-name-one-column sites-layout-hbox">
															<tbody>
																<tr>
																	<td class="sites-layout-tile sites-tile-name-content-1"
																		style="font-size: 12px; font: 10pt Arial, sans-serif;">





																		<a id="refreshDate"
																		style="font-size: 10pt; text-align: left;"></a>
																		<table class="gradienttable" id="tableServices">
																			<thead>
																				<tr align="center" height="40px">
																					<th width="25%">Servicio</th>
																					<th width="25%">Aplicación</th>
																					<th width="15%">Tiempo medio</th>
																					<th width="15%">% Por debajo del TimeOut</th>
																					<th width="20%">% Por encima del TimeOut</th>
																				</tr>
																			</thead>
																			<tbody>
																			</tbody>
																		</table>




																	</td>
																</tr>
																<tr>
																	<td>
																		<div id="bigotes"></div>
																	</td>
																</tr>
															</tbody>
														</table>
													</div>
												</div>

											</div>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>

				</div>
			</div>

		</div>
	</div>


</body>
</html>